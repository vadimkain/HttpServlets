<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<h1>HTTP. Servlets. 39. JSP. Жизненный цикл JSP</h1>
<p>JSP - это на самом деле сервлеты, которые генерируют HTML страницу, когда к ним обращаемся.</p>
<h3>Рассмотрим более подробно, что из себя представляет JSP:</h3>
<img src="commit-39-1.png" width="55%" />
<p>
    Мы видим, что у нас есть какая-то .jsp страница, которая выглядит как обычная HTML страничка, но есть какие-то
    директивы и ещё могут быть какие-то вставки java кода и expression языка, следовательно. Наша задача сейчас - это
    преобразовать .jsp страницу в сервлет, который за нас сделает эти неприятные преобразования, используя
    <code>OutputStream</code>. Т.е. то, что делали до этого. И для преобразования .jsp страницы в сервлет как раз
    таки и нужен <b>Jasper</b> (один из компонентов Apache Tomcat, занимается .jsp страничками).
</p>
<p>
    Jasper берёт .jsp страничку, которая выглядит как html и преобразует её в java класс. И этот класс наследует
    <code>HttpJspBase</code>, который на самом деле является наследником нашего обычного <code>HttpServlet</code>'a.
    Всё, что он делает - это преобразует всякие директивы в java код и далее берёт всё оставшееся тело, и так же
    преобразовывает в зависимости от того, что напишем. Если это будут обычные html теги, то просто записывает в
    <code>OutputStream</code>. Если какой-то java код вкрапления, то вставляет и компилирует в нашем методе, который
    называется <code style="color: red">._jspService(req, resp)</code>. Он вызывается из общего метода
    <code>.service(req, resp)</code>. Т.е. этот метод в <code>HttpServlet</code>, который принимает все наши HTTP
    запросы и проксирует на соответствующий <code>doGet()</code>, <code>doPost()</code>, <code>doPut()</code> и т.д..
</p>
<p>
    После того, как он сгенерировал такой класс - он компилирует его, т.е. преобразует в файл с расширением
    <code>.class</code> и т.к. этот класс является обычным сервлетом, следовательно, все что остаётся сделать - это
    продолжить работать с ним как с обычным сервлетом. Т.е., начинаются все фазы жизненого цикла сервлета. Т.е.,
    загружаем в JVM, создаём экземпляр класса и вызываем метод <code>.init()</code>. После чего вызываем у этого
    сервлета метод <code>.service()</code>, который проксирует уже запрос на метод <code>._jspService()</code>. И далее,
    когда мы заканчиваем выполнение приложения, вызывается метод <code>.destroy()</code> у сервлета. Главное понимать,
    что процесс преобразования .jsp страницы в сервлет происходит только один раз - при первом обращении к этой
    страничке.
</p>
<img src="commit-26-2.png" width="80%"/>
<p>
    Т.е., все работает как обычный сервлет. Следовательно, жизненный цикл .jsp заключается в том, что мы сначала
    берём .jsp страницу при первом обращении к ней. Преобразовываем в .java класс, наследуясь от <code>HttpJspBase</code>.
    И преобразуем все содержимое .jsp странички просто в метод <code style="color: red">._jspService(req, resp)</code>.
    Далее компилируем этот класс и после этого этот класс становится обычным скомпилированным сервлетом, который
    попадает в жизненный цикл сервлета и происходит загрузка в JVM, создание нового instance, вызова метода
    <code>.init()</code> и при каждом обращении метод <code>.service()</code>.
</p>
</body>
</html>